# Vercel Deployment Checklist

Your project is now ready to deploy to Vercel with both frontend and serverless backend. Follow these steps:

## Pre-Deployment Checklist

### 1. Database Setup ✅
- [ ] Create a PostgreSQL database (Vercel Postgres, Supabase, Railway, or ElephantSQL)
- [ ] Copy the DATABASE_URL connection string

### 2. Secrets Generation ✅
- [ ] Generate JWT_SECRET (32+ random characters)
- [ ] Generate JWT_REFRESH_SECRET (32+ random characters)
- [ ] Store these securely

### 3. GitHub Setup ✅
- [ ] Push your repo to GitHub (branch: `main` or `master`)
- [ ] Verify `api/` folder exists at repo root
- [ ] Verify `.github/workflows/deploy.yml` exists

### 4. Local Migration (Run Once!) ✅
```powershell
$env:DATABASE_URL = "your-postgres-connection-string"
cd server
npm install
npx prisma generate
npx prisma migrate deploy
node prisma/seed.js
```

### 5. Vercel Project Setup ✅
- [ ] Create/Login to Vercel account
- [ ] Import GitHub repository
- [ ] Set Environment Variables:
  - DATABASE_URL
  - JWT_SECRET
  - JWT_REFRESH_SECRET
  - VITE_API_URL = `/api`
- [ ] Deploy

### 6. Post-Deployment Testing ✅
- [ ] Visit `https://<your-project>.vercel.app`
- [ ] Test register/login flow
- [ ] Test plan browsing
- [ ] Test subscription creation
- [ ] Test dark/light mode toggle
- [ ] Check browser console for errors

### 7. Optional: Set Up GitHub Actions ✅
For automatic migrations on future deploys:
- [ ] Add `VERCEL_TOKEN` to GitHub Secrets
- [ ] Add `VERCEL_ORG_ID` to GitHub Secrets
- [ ] Add `VERCEL_PROJECT_ID` to GitHub Secrets
- [ ] Add `DATABASE_URL` to GitHub Secrets

---

## Project Structure (Deployed to Vercel)

```
/api                          ← Vercel serverless functions
  ├── auth/
  │   ├── login.js
  │   ├── register.js
  │   └── refresh.js
  ├── subscribe/
  │   └── [planId].js
  ├── admin/
  │   └── subscriptions.js
  ├── health.js
  ├── plans.js
  ├── my-subscription.js
  └── _prisma.js (cached Prisma client)

/client                       ← React frontend (Vite)
  ├── src/
  ├── dist/                   ← Built files (deployed)
  └── ...

/server                       ← Local Express (not deployed)
  ├── prisma/
  │   ├── schema.prisma       ← PostgreSQL schema
  │   ├── migrations/         ← Auto-generated by Prisma
  │   └── seed.js
  └── src/

vercel.json                   ← Vercel configuration
```

---

## Endpoint Mapping

| Method | Path | Handler |
|--------|------|---------|
| POST | `/api/auth/register` | `api/auth/register.js` |
| POST | `/api/auth/login` | `api/auth/login.js` |
| POST | `/api/auth/refresh` | `api/auth/refresh.js` |
| GET | `/api/plans` | `api/plans.js` |
| POST | `/api/subscribe/:planId` | `api/subscribe/[planId].js` |
| GET | `/api/my-subscription` | `api/my-subscription.js` |
| GET | `/api/admin/subscriptions` | `api/admin/subscriptions.js` |
| GET | `/api/health` | `api/health.js` |

---

## Environment Variables (Set in Vercel)

```
DATABASE_URL=postgresql://user:password@host:port/database
JWT_SECRET=<your-generated-secret>
JWT_REFRESH_SECRET=<your-generated-secret>
VITE_API_URL=/api
```

---

## Troubleshooting Quick Links

See **DEPLOYMENT.md** for detailed troubleshooting:
- 404 on API endpoints
- Module not found errors
- Connection refused / Database errors
- 401 Unauthorized on login
- CORS errors

---

## Summary

✅ **Prisma migrated to PostgreSQL**
✅ **All Express routes ported to serverless functions**
✅ **Frontend configured to use /api**
✅ **Vercel routing configured**
✅ **GitHub Actions workflow ready for automatic migrations**
✅ **Comprehensive deployment guide (DEPLOYMENT.md)**

**Next Step:** Follow the steps in DEPLOYMENT.md to deploy!
